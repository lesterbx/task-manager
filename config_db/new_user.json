{
  "_id": "_design/new_user",
  "language": "javascript",
  "validate_doc_update":  "function (newDoc, savedDoc) {\r\n  function required(field, message){\r\n    if(newDoc[field] === undefined || newDoc[field] === ''){\r\n      throw({forbidden: message});\r\n    }\r\n  }\r\n\r\n  required('first_name', 'Missing first name');\r\n  required('last_name', 'Missing last name');\r\n  required('password', 'Missing password');\r\n  required('name', 'Missing email');\r\n\r\n  function valid(field, regex, message){\r\n    if(!regex.test(newDoc[field])){\r\n      throw({forbidden: message});\r\n    }\r\n  }\r\n\r\n  var emailRegex = \/^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$\/;\r\n  var nameRegex = \/^[a-zA-Z]+$\/;\r\n\r\n  valid('name', emailRegex, 'Invalid email format');\r\n  valid('first_name', nameRegex, 'First name can only contain letters');\r\n  valid('last_name', nameRegex, 'Last name can only contain letters');\r\n\r\n}"
}